---
import { renderToString } from "react-dom/server";
import Email from "../../../layouts/Email.astro";
import { renderTemplate, exportTemplate } from "../../../lib/utils";
const { slug } = Astro.params;
const { pathname } = Astro.url;

// loads all templates
// I was not able to do this more dynamically
const matches = import.meta.glob("/**/*.jsx", {
  eager: true,
});
console.log({ pathname });
const file = matches[`/src${pathname}.jsx`];
console.log({ jsxMatches: matches });
// creates HTML from mjml in JSX template and exports it as html to new location
// @ts-ignore
const template = renderTemplate(file?.default());
await exportTemplate({
  fileName: slug!.replace("js", ""),
  type: "js",
  content: template,
});
// const template = "hello here";
---

{
  (
    // @ts-ignore
    <Email title={file?.title}>
      {file && <Fragment set:html={template} />}
    </Email>
  )
}
